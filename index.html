<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Sudofy – type & solve</title>
  <style>
    body{ font-family:system-ui, sans-serif; display:grid; place-content:center; min-height:100vh; background:#111; color:#0f0; }
    table{ border-collapse:collapse; }
    td{ width:48px; height:48px; border:1px solid #444; text-align:center; }
    tr:nth-child(3n) td{ border-bottom:3px solid rgb(139, 7, 108); }
    td:nth-child(3n){ border-right:3px solid rgb(139, 7, 108); }
    tr:nth-child(3n+1) td{ border-top:3px solid rgb(139, 7, 108); }
    td:nth-child(3n+1){ border-left:3px solid rgb(139, 7, 108); }
    input{ width:100%; height:100%; font-size:24px; text-align:center; background:transparent; color:rgb(236, 240, 236); border:none; outline:none; }
    button{ margin-top:12px; padding:8px 16px; font-size:16px; cursor:pointer; }
  </style>
</head>
<body>
  <table id="grid"></table>
  <button id="lockBtn">Lock & Solve</button>

  <script>
    const SIZE = 9;
    const table = document.getElementById('grid');

    // create 9×9 input boxes
    for (let r = 0; r < SIZE; r++) {
      const tr = table.insertRow();
      for (let c = 0; c < SIZE; c++) {
        const td = tr.insertCell();
        const inp = document.createElement('input');
        inp.type = 'text';
        inp.maxLength = 1;
        inp.oninput = e => e.target.value = e.target.value.replace(/[^1-9]/g,'');
        td.appendChild(inp);
      }
    }

    document.getElementById('lockBtn').onclick = () => {
      const grid = [];
      for (let r = 0; r < SIZE; r++) {
        const row = [];
        for (let c = 0; c < SIZE; c++) {
          const v = table.rows[r].cells[c].firstChild.value;
          row.push(v ? parseInt(v) : 0);
        }
        grid.push(row);
      }

      const ws = new WebSocket('ws://localhost:8000/solve');
      ws.onopen = () => ws.send(JSON.stringify({grid}));
      ws.onmessage = m => {
        const pkt = JSON.parse(m.data);
        if (pkt.status === 'done') { ws.close(); return; }
        const b = pkt.board;
        for (let r = 0; r < SIZE; r++)
          for (let c = 0; c < SIZE; c++)
            table.rows[r].cells[c].firstChild.value = b[r][c] || '';
      };
    };
  </script>
</body>
</html>